<mxfile host="app.diagrams.net" modified="2024-07-02T11:10:36.951Z" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36" etag="25kldYc-fElmETRyRG6v" version="24.6.3" type="google">
  <diagram name="Page-1" id="edf60f1a-56cd-e834-aa8a-f176f3a09ee4">
    <mxGraphModel dx="2585" dy="1368" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="850" background="none" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="pypL57QcDQIKralvQE_X-5" value="Edge Device" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="230" y="60" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-6" value="Cloud Device" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="785" y="40" width="120" height="60" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-7" value="&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;State=0 /\ RCV(start) =|&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; State&#39; := 1 /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; SND({C.S.Hash(UID.PW)}_PKS)&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="80" y="160" width="470" height="220" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-13" value="&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;State=0 /\ RCV({C.S.Hash(UID&#39;.PW&#39;)}_PKS) /\ UID = UID&#39; /\ PW = PW&#39; =|&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; State&#39; := 1 /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; TKi&#39; := new() /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Na&#39; := new() /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; Timestamp&#39; := new() /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; SND({S.C.Hash(UID.TKi.Timestamp).Na}_PKC)&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="650" y="140" width="430" height="450" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-14" value="&lt;div style=&quot;font-size: 17px;&quot;&gt;&lt;font style=&quot;font-size: 17px;&quot;&gt;State=1 /\ RCV({C.S.Hash(UID.TKi.Timestamp).Na.OTPc&#39;}_PKS) /\ request(C,S,auth_1,Na) =|&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 17px;&quot;&gt;&lt;font style=&quot;font-size: 17px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; State&#39; := 2 /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 17px;&quot;&gt;&lt;font style=&quot;font-size: 17px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; OTPc&#39; := OTPc /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 17px;&quot;&gt;&lt;font style=&quot;font-size: 17px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; OTPs&#39; := 123&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="610" y="630" width="470" height="480" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-15" value="&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;State=2 /\ OTPc = OTPs =|&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; State&#39; := 3 /\ FTKi&#39; := new() /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; SND({S.C.Hash(UID.SK.FTKi.Timestamp)}_PKC) /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; secret(SK, sec_2, {S, C})&amp;nbsp;&lt;/font&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="675" y="1180" width="410" height="450" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-16" value="&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;State=1 /\ RCV({S.C.Hash(UID.TKi&#39;.Timestamp&#39;).Na&#39;}_PKC) =|&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; State&#39; := 2 /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; SND({C.S.Hash(UID.TKi.Timestamp).Na.OTPc}_PKS) /\&amp;nbsp;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; secret(OTPc, sec_1, {C,S}) /\&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space: normal;&quot;&gt;&lt;font style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;white-space:pre&quot;&gt;&#x9;&lt;/span&gt;&amp;nbsp; &amp;nbsp; witness(S,C,auth_1,Na&#39;)&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 16px;&quot;&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="70" y="540" width="420" height="560" as="geometry" />
        </mxCell>
        <mxCell id="pypL57QcDQIKralvQE_X-17" value="&lt;div style=&quot;font-size: 17px;&quot;&gt;&lt;font style=&quot;font-size: 17px;&quot;&gt;State=2 /\ RCV({S.C.Hash(UID.SK&#39;.FTKi&#39;.Timestamp)}_PKC) =|&amp;gt;&lt;/font&gt;&lt;/div&gt;&lt;div style=&quot;font-size: 17px;&quot;&gt;&amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; &amp;nbsp; State&#39; := 3&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fillColor=#FAE5C7;strokeColor=#0F8B8D;fontColor=#143642;" parent="1" vertex="1">
          <mxGeometry x="160" y="1190" width="410" height="360" as="geometry" />
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-11" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.908;entryY=0.015;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0;exitY=0.639;exitDx=0;exitDy=0;exitPerimeter=0;labelBackgroundColor=none;strokeColor=#A8201A;fontColor=default;" parent="1" source="pypL57QcDQIKralvQE_X-13" target="pypL57QcDQIKralvQE_X-16" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="620" y="400" as="sourcePoint" />
            <mxPoint x="610" y="320" as="targetPoint" />
            <Array as="points">
              <mxPoint x="520" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-13" value="" style="endArrow=classic;html=1;rounded=0;labelBackgroundColor=none;strokeColor=#A8201A;fontColor=default;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="550" y="240" as="sourcePoint" />
            <mxPoint x="630" y="240" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-16" value="" style="endArrow=classic;html=1;rounded=0;labelBackgroundColor=none;strokeColor=#A8201A;fontColor=default;" parent="1" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="490" y="909" as="sourcePoint" />
            <mxPoint x="609" y="909" as="targetPoint" />
            <Array as="points">
              <mxPoint x="560" y="909" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-17" value="" style="endArrow=classic;html=1;rounded=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;labelBackgroundColor=none;strokeColor=#A8201A;fontColor=default;" parent="1" target="pypL57QcDQIKralvQE_X-15" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="880" y="1110" as="sourcePoint" />
            <mxPoint x="876.4000000000001" y="639.8800000000001" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-18" value="" style="endArrow=classic;html=1;rounded=0;exitX=0;exitY=0.5;exitDx=0;exitDy=0;labelBackgroundColor=none;strokeColor=#A8201A;fontColor=default;" parent="1" source="pypL57QcDQIKralvQE_X-15" edge="1">
          <mxGeometry width="50" height="50" relative="1" as="geometry">
            <mxPoint x="667" y="1406" as="sourcePoint" />
            <mxPoint x="570" y="1404" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-19" value="&lt;font size=&quot;3&quot;&gt;&lt;b&gt;send the UID AND PW (hashed ) to the cloud server&lt;/b&gt;&lt;/font&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#143642;darkOpacity=0.05;fillColor=#FAE5C7;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;shadow=1;size=20;pointerEvents=1;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="90" y="300" width="450" height="60" as="geometry" />
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-21" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;After receiving the UID AND PW it check the UID AND PW&amp;nbsp; for match and then send the edge device a new jwt token TKi .&lt;/b&gt;&lt;/font&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#143642;darkOpacity=0.05;fillColor=#FAE5C7;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;shadow=1;size=20;pointerEvents=1;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="681" y="460" width="350" height="120" as="geometry" />
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-22" value="&lt;font color=&quot;#ffffff&quot; data-darkreader-inline-color=&quot;&quot; style=&quot;font-size: 18px; --darkreader-inline-color: #e8e6e3;&quot;&gt;&lt;b style=&quot;&quot;&gt;After getting the OTP ; the server check the OTP with its own generated OTP , here it is putted by manually.&lt;/b&gt;&lt;/font&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#143642;darkOpacity=0.05;fillColor=#FAE5C7;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;shadow=1;size=20;pointerEvents=1;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="635" y="940" width="420" height="130" as="geometry" />
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-23" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;After receiving the Tki the edge device send to the cloud server a OTP (manually entered)&lt;/b&gt;&lt;/font&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#143642;darkOpacity=0.05;fillColor=#FAE5C7;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;shadow=1;size=20;pointerEvents=1;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="95" y="910" width="370" height="160" as="geometry" />
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-24" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;If the OTPc and OTPs match .. then the server send the secret SK to the device as a token&lt;/b&gt;&lt;/font&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#143642;darkOpacity=0.05;fillColor=#FAE5C7;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;shadow=1;size=20;pointerEvents=1;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="720" y="1470" width="340" height="130" as="geometry" />
        </mxCell>
        <mxCell id="mNG9zx6XF5VJLSDNo_tC-25" value="&lt;font style=&quot;font-size: 18px;&quot;&gt;&lt;b&gt;It get the secret safely&lt;/b&gt;&lt;/font&gt;" style="shape=note;whiteSpace=wrap;html=1;backgroundOutline=1;fontColor=#143642;darkOpacity=0.05;fillColor=#FAE5C7;strokeColor=none;fillStyle=solid;direction=west;gradientDirection=north;shadow=1;size=20;pointerEvents=1;labelBackgroundColor=none;" parent="1" vertex="1">
          <mxGeometry x="180" y="1440" width="330" height="80" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
